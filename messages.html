<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Messagerie - √âcole Pas Directe</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #f0f4f8;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      height: 60px;
      background: #005fa3;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 10;
    }

    #brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      font-size: 1.3rem;
      color: white;
    }

    #brand img {
      height: 40px;
      width: 40px;
      object-fit: cover;
      border-radius: 50%;
    }

    .back-link {
      color: white;
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .container {
      margin-top: 60px;
      padding: 20px;
      flex-grow: 1;
      display: flex;
      height: calc(100vh - 60px);
    }

    .messaging-container {
      display: flex;
      width: 100%;
      gap: 15px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.05);
      overflow: hidden;
    }

    .conversations-panel {
      flex: 0 0 25%;
      border-right: 1px solid #dee2e6;
      overflow-y: auto;
      background: #f9f9f9;
    }

    .conversations-header {
      padding: 15px;
      border-bottom: 2px solid #005fa3;
      background: white;
      position: sticky;
      top: 0;
    }

    .conversations-header h3 {
      margin: 0;
      color: #005fa3;
      font-size: 1.1rem;
    }

    .conversations-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .conversation-item {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 4px solid transparent;
    }

    .conversation-item:hover {
      background-color: #e8f1f8;
    }

    .conversation-item.active {
      background-color: #e3f2fd;
      border-left-color: #005fa3;
      font-weight: 600;
    }

    .conversation-name {
      font-weight: 600;
      color: #005fa3;
      margin-bottom: 3px;
    }

    .conversation-preview {
      font-size: 0.9rem;
      color: #666;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .chat-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: white;
    }

    .chat-header {
      padding: 15px;
      border-bottom: 2px solid #005fa3;
      background: #f9f9f9;
    }

    .chat-title {
      margin: 0;
      color: #005fa3;
      font-size: 1.1rem;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .message {
      max-width: 70%;
      padding: 12px 15px;
      border-radius: 8px;
      word-wrap: break-word;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.sent {
      align-self: flex-end;
      background-color: #005fa3;
      color: white;
    }

    .message.received {
      align-self: flex-start;
      background-color: #f0f4f8;
      color: #333;
    }

    .message-sender {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 0.9rem;
    }

    .message-content {
      margin-bottom: 4px;
    }

    .message-time {
      font-size: 0.8rem;
      opacity: 0.7;
    }

    .chat-input-area {
      padding: 15px;
      border-top: 1px solid #dee2e6;
      background: #f9f9f9;
    }

    .chat-form {
      display: flex;
      gap: 10px;
    }

    #message-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      resize: vertical;
      max-height: 80px;
    }

    .send-btn {
      background-color: #005fa3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;
      transition: background-color 0.3s;
    }

    .send-btn:hover {
      background-color: #00497d;
    }

    .empty-chat {
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 1.1rem;
    }

    .delete-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: background-color 0.3s;
    }

    .delete-btn:hover {
      background-color: #c82333;
    }
  </style>
</head>
<body>

<header>
  <div id="brand">
    <img src="1747986702534.jpeg" alt="Logo" />
    <span>Messagerie</span>
  </div>
  <a href="home.html" class="back-link">‚Üê Retour √† l'accueil</a>
</header>

<div class="container">
  <div class="messaging-container">
    <!-- Panel de conversations -->
    <div class="conversations-panel">
      <div class="conversations-header">
        <h3>üí¨ Conversations</h3>
      </div>
      <ul class="conversations-list" id="conversations-list">
        <!-- Les conversations vont appara√Ætre ici -->
      </ul>
    </div>

    <!-- Panel de chat -->
    <div class="chat-panel">
      <div class="chat-header">
        <h3 class="chat-title" id="chat-title">S√©lectionne une conversation</h3>
        <button class="delete-btn" id="delete-btn" style="display: none;">üóëÔ∏è Effacer la conversation</button>
      </div>

      <div class="chat-messages" id="chat-messages">
        <div class="empty-chat">S√©lectionne une conversation pour commencer</div>
      </div>

      <div class="chat-input-area" id="input-area" style="display: none;">
        <form class="chat-form" id="chat-form">
          <input 
            type="text" 
            id="message-input" 
            placeholder="√âcris ton message..." 
            autocomplete="off"
          />
          <button type="submit" class="send-btn">Envoyer ‚úâÔ∏è</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // V√©rifier l'authentification
  if (sessionStorage.getItem("isLoggedIn") !== "true") {
    window.location.href = "index.html";
  }

  const currentUser = sessionStorage.getItem("currentUser");
  if (!currentUser) {
    sessionStorage.clear();
    window.location.href = "index.html";
  }

  // Initialiser le localStorage avec les messages par d√©faut
  function initializeMessages() {
    if (!localStorage.getItem("schoolMessages")) {
      const defaultMessages = {
        "Alex-Johan": [
          { sender: "Alex", content: "Salut Johan! √áa va?", timestamp: "10:30" },
          { sender: "Johan", content: "Ouais √ßa va! Et toi?", timestamp: "10:35" },
          { sender: "Alex", content: "Bien bien, tu as fais tes devoirs?", timestamp: "10:40" }
        ],
        "Prof. SVT": [
          { sender: "Prof. SVT", content: "Le TP est en ligne sur Moodle.", timestamp: "14:30" }
        ],
        "Prof. Maths": [
          { sender: "Prof. Maths", content: "N'oubliez pas la r√©vision du chapitre 3.", timestamp: "10:15" }
        ],
        "Prof. EPS": [
          { sender: "Prof. EPS", content: "Apportez vos baskets jeudi.", timestamp: "09:00" }
        ],
        "Prof. Fran√ßais": [
          { sender: "Prof. Fran√ßais", content: "Contr√¥le de lecture vendredi.", timestamp: "11:20" }
        ],
        "Prof. Physique": [
          { sender: "Prof. Physique", content: "Les exercices sont √† faire pour demain.", timestamp: "15:00" }
        ]
      };
      localStorage.setItem("schoolMessages", JSON.stringify(defaultMessages));
    }
  }

  const conversationsConfig = {
   "Alex": { name: "Alex", icon: "üßë‚Äçüçº", key: "Alex-Johan" },
    "Johan": { name: "Johan", icon: "ü´É", key: "Alex-Johan" },
    "Prof. SVT": { name: "Prof. SVT", icon: "üë®‚Äçüè´", key: "Prof. SVT" },
    "Prof. Maths": { name: "Prof. Maths", icon: "üìê", key: "Prof. Maths" },
    "Prof. EPS": { name: "Prof. EPS", icon: "‚öΩ", key: "Prof. EPS" },
    "Prof. Fran√ßais": { name: "Prof. Fran√ßais", icon: "üìö", key: "Prof. Fran√ßais" },
    "Prof. Physique": { name: "Prof. Physique", icon: "‚öõÔ∏è", key: "Prof. Physique" }
  };

  let currentConversation = null;

  // Fonction IA simul√©e qui analyse le message et r√©pond intelligemment
  function generateAIResponse(userMessage) {
    const msg = userMessage.toLowerCase();

    // D√©terminer le contexte du message
  
if (msg.includes("bas quoi") || msg.includes("ya quoi") || msg.includes("tu veut quoi ") || msg.includes("quoi ?") ) {
      return [
        "bas juste parle bien",
       "bas ftg juste"
      ];
    }
    if (msg.includes("bonjour") || msg.includes("slt") || msg.includes("salut") || msg.includes("yo") ) {
      return [
        "ouai salut ya quoi bg?",
       " ouai tvquoi"
      ];
    }
   if (msg.includes("controle") ) {
      return [
        "oui",
         "bas nn tdb"
      ];
    }

    if (msg.includes("gros") || msg.includes("√©norme") || msg.includes("patate") || msg.includes("grosse")) {
      return [
        "qui ta √©duquer p'tit batard",
        "boufe mes c*****",
        "tu est mm pas pret a ce qui vas tariver",
        "salle chlage"
      ];
    }
    if (msg.includes("devoir") || msg.includes("homework") || msg.includes("exercice")) {
      return [
        "fait tes devoire ou je te ba***",
        "tg en 2 2",
        "bas tfacon t moche gros sac ",
        "blc sah"
      ];
    }
    if (msg.includes("note") || msg.includes("points") || msg.includes("r√©sultat") || msg.includes("score")) {
      return [
        "qui ta demander mm ??? ",
        "jmen fout laisse moi stp ",
        "bas gg bg ",
        "continus comment sa nn je rigole jmen fou"
      ];
    }
    if (msg.includes("ou")|| msg.includes("?")) {
      return [
        "cher ta soeur",
        "cher toi je doit voir quelqun ",
        "jsp jmen fou un peut en vrai ",

      ];
    }
    if (msg.includes("absent") || msg.includes("malade") || msg.includes("justif") || msg.includes("absence")) {
      return [
        "bien fait pti faible",
        "Repose en paix",
        "ok soufre bien mec",
        "mdr la honte"
      ];
    }
    if (msg.includes("aide") || msg.includes("comprendre") || msg.includes("expliquer") || msg.includes("comment")) {
      return [
        "personne taime tu crois on vas taider ?",
        "nn flm ",
      ];
    }
    if (msg.includes("merci") || msg.includes("merci beaucoup") || msg.includes("mrc")) {
      return [
        "ok ",
        "ouai nn ",
        "oula",
        "t gay ou quoi ",
      ];
    }
     if (msg.includes("92i")|| msg.includes("abdel")) {
      return [
        " abdeltesticrousi92i",
        
      ];
    }
    if (msg.includes("peter")|| msg.includes("beatboxe")) {
      return [
        "yo c'est peter beatboxe le roi des mec styl√©",
        
      ];
    }
   
    return [
      "je comprent pas ce qui tu dit le compte de t mort",
      "quesqui raconte sfdp",
      "oui bas parle fr deja stp",
      "ton corp de faible tu vien me parl√© la ",
    ];
  }

  // Initialiser les conversations
  function loadConversations() {
    initializeMessages();
    const list = document.getElementById("conversations-list");
    const messagesData = JSON.parse(localStorage.getItem("schoolMessages") || "{}");

    list.innerHTML = "";

    Object.keys(conversationsConfig).forEach(key => {
      const conv = conversationsConfig[key];
      if (conv.name === currentUser) return;

      const li = document.createElement("li");
      li.className = "conversation-item";
      li.setAttribute("data-key", key);
      li.onclick = () => openConversation(key);

      const msgs = messagesData[conv.key] || [];
      const lastMsg = msgs.length > 0 ? msgs[msgs.length - 1] : { content: "Pas de messages" };

      li.innerHTML = `
        <div class="conversation-name">${conv.icon} ${conv.name}</div>
        <div class="conversation-preview">${lastMsg.content}</div>
      `;
      list.appendChild(li);
    });
  }

  // Ouvrir une conversation
  function openConversation(key) {
    currentConversation = key;
    const conv = conversationsConfig[key];

    document.querySelectorAll(".conversation-item").forEach(el => {
      el.classList.remove("active");
    });

    document.querySelector(`[data-key="${key}"]`)?.classList.add("active");
    document.getElementById("chat-title").textContent = `${conv.icon} ${conv.name}`;
    document.getElementById("delete-btn").style.display = "block";
    displayMessages();
    document.getElementById("input-area").style.display = "block";
    document.getElementById("message-input").focus();
  }

  // Afficher les messages
  async function displayMessages() {
    if (!currentConversation) return;

    const conv = conversationsConfig[currentConversation];
    const chatArea = document.getElementById("chat-messages");

    chatArea.innerHTML = "";

    try {
      // Charger depuis localStorage d'abord (plus rapide)
      const messagesData = JSON.parse(localStorage.getItem("schoolMessages") || "{}");
      const msgs = messagesData[conv.key] || [];

      if (!msgs || msgs.length === 0) {
        chatArea.innerHTML = '<div class="empty-chat">Aucun message pour l\'instant</div>';
        return;
      }

      msgs.forEach(msg => {
        const div = document.createElement("div");
        const isOwn = msg.sender === currentUser;
        div.className = `message ${isOwn ? "sent" : "received"}`;
        div.innerHTML = `
          <div class="message-sender">${msg.sender}</div>
          <div class="message-content">${msg.content}</div>
          <div class="message-time">${msg.timestamp}</div>
        `;
        chatArea.appendChild(div);
      });

      setTimeout(() => {
        chatArea.scrollTop = chatArea.scrollHeight;
      }, 50);
    } catch(err) {
      console.error("Erreur chargement messages:", err);
      chatArea.innerHTML = '<div class="empty-chat">Erreur de chargement</div>';
    }
  }

  // Envoyer un message
  document.getElementById("chat-form").addEventListener("submit", async function(e) {
    e.preventDefault();

    if (!currentConversation) {
      alert("S√©lectionne une conversation");
      return;
    }

    const input = document.getElementById("message-input");
    const message = input.value.trim();

    if (message === "") return;

    const conv = conversationsConfig[currentConversation];
    const messagesData = JSON.parse(localStorage.getItem("schoolMessages") || "{}");
    const msgs = messagesData[conv.key] || [];

    const now = new Date();
    const time = now.toLocaleTimeString("fr-FR", { hour: '2-digit', minute: '2-digit' });

    msgs.push({
      sender: currentUser,
      content: message,
      timestamp: time
    });

    messagesData[conv.key] = msgs;
    localStorage.setItem("schoolMessages", JSON.stringify(messagesData));

    displayMessages();
    input.value = "";
    input.focus();

    // R√©ponse automatique pour les profs (avec IA simul√©e)
    if (conv.key !== "Alex-Johan") {
      setTimeout(() => {
        const responses = generateAIResponse(message);
        const response = responses[Math.floor(Math.random() * responses.length)];

        const respTime = new Date();
        respTime.setSeconds(respTime.getSeconds() + 1);
        const respTimeStr = respTime.toLocaleTimeString("fr-FR", { hour: '2-digit', minute: '2-digit' });

        msgs.push({
          sender: conv.name,
          content: response,
          timestamp: respTimeStr
        });

        messagesData[conv.key] = msgs;
        localStorage.setItem("schoolMessages", JSON.stringify(messagesData));
        displayMessages();
      }, 1000);
    }
  });

  // Charger les conversations au d√©marrage
  loadConversations();

  // Bouton pour effacer la conversation
  document.getElementById("delete-btn").addEventListener("click", function() {
    if (!currentConversation) return;

    const confirmed = confirm("Es-tu s√ªr(e) de vouloir effacer tous les messages de cette conversation? Cette action est irr√©versible!");
    if (!confirmed) return;

    const conv = conversationsConfig[currentConversation];
    const messagesData = JSON.parse(localStorage.getItem("schoolMessages") || "{}");

    // Supprimer la conversation
    messagesData[conv.key] = [];
    localStorage.setItem("schoolMessages", JSON.stringify(messagesData));

    // R√©initialiser l'affichage
    document.getElementById("chat-messages").innerHTML = '<div class="empty-chat">Conversation effac√©e. Les messages ont √©t√© supprim√©s.</div>';
    document.getElementById("message-input").value = "";
    
    // Recharger la liste
    loadConversations();
  });
//test1 
</script>





<script>
  const secretCode = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowUp'];
let userSequence = [];

document.addEventListener('keydown', (e) => {
    if (e.key.startsWith('Arrow')) {
        userSequence.push(e.key);
        
        // Garder seulement les 5 derni√®res touches
        if (userSequence.length > 5) {
            userSequence.shift();
        }
        
        // V√©rifier si la s√©quence correspond
        if (userSequence.length === 5) {
            let match = true;
            for (let i = 0; i < 5; i++) {
                if (userSequence[i] !== secretCode[i]) {
                    match = false;
                    break;
                }
            }
            
            if (match) {
                window.location.href = 'troll.html';
            }
        }
    }
});
</script>

</body>
</html>
